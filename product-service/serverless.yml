# Welcome to Serverless!
#
# This file is the main config file for your service.
# It's very minimal at this point and uses default values.
# You can always add more config options for more control.
# We've included some commented out config examples here.
# Just uncomment any of them to get that config option.
#
# For full config options, check the docs:
#    docs.serverless.com
#
# Happy Coding!

service: product-service
# app and org for use with dashboard.serverless.com
#app: your-app-name
#org: your-org-name

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
frameworkVersion: "3"

provider:
  name: aws
  runtime: nodejs18.x
  stage: dev
  region: eu-west-1
  environment:
    PRODUCTS_TABLE: products
    STOCKS_TABLE: stocks
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - dynamodb:Scan
            - dynamodb:GetItem
            - dynamodb:Query
            - dynamodb:PutItem
          Resource:
            - "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.PRODUCTS_TABLE}"
            - "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.STOCKS_TABLE}"
            - "arn:aws:dynamodb:${opt:region, self:provider.region}:*:table/${self:provider.environment.STOCKS_TABLE}/index/ProductIndex"

functions:
  createProduct:
    handler: dist/handler.createProduct
    events:
      - http:
          path: products
          method: post
          cors: true

  getProductsList:
    handler: dist/handler.getProductsList
    events:
      - http:
          path: products
          method: get
          cors: true
          documentation:
            summary: "Get list of products"
            description: "Returns a list of all products"
            tags:
              - "Products"
            responses:
              200:
                description: "List of products"
                responseSchema:
                  type: array
                  items:
                    ref: "Product"

  getProductsById:
    handler: dist/handler.getProductsById
    events:
      - http:
          path: products/{id}
          method: get
          cors: true
          documentation:
            summary: "Get product by ID"
            description: "Returns a specific product by ID"
            pathParams:
              - name: "id"
                description: "Product ID"
                paramType: "path"
                type: string
                required: true
            tags:
              - "Products"
            responses:
              200:
                description: "Product found"
                responseSchema:
                  ref: "Product"

plugins:
  - serverless-aws-documentation
  - serverless-offline

custom:
  documentation:
    api:
      info:
        version: "1.0.0"
        title: "Product Service API"
    models:
      - name: "Product"
        description: "Product Model"
        contentType: "application/json"
        schema:
          type: object
          required:
            - id
            - count
            - description
            - price
            - title
          properties:
            id:
              type: string
              description: "Product ID"
            count:
              type: integer
              description: "Product count"
            description:
              type: string
              description: "Product description"
            price:
              type: number
              description: "Product price"
            title:
              type: string
              description: "Product title"

